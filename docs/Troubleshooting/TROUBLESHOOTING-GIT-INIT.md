# Gitリポジトリ初期化の失敗と復旧の記録

## 概要

このドキュメントは、プロジェクト設定の初期段階で発生したGitリポジトリに関する複数の問題を特定し、解決するまでの一連のトラブルシューティングの過程を記録するものです。

### 発生した主な問題

1.  **不適切なリポジトリの初期化**: プロジェクトルートではなく、ユーザーのホームディレクトリ (`C:\Users\tenma`) で `git init` が実行され、プロジェクト外の全個人ファイルが追跡対象となっていた。
2.  **ネストされたリポジトリ**: `frontend` ディレクトリ内にも `.git` フォルダが存在し、親リポジトリが `frontend` 内のファイルを正しく追跡できない状態だった。
3.  **不完全な `.gitignore`**: `.gitignore` の設定が不十分で、キャッシュフォルダ (`.vite`, `.serena`) など、バージョン管理に含めるべきでないファイルがコミットに含まれてしまった。

---

## 復旧への道のり

### Step 1: 問題の診断

- `git status` を実行したところ、プロジェクト外の多数のファイルが表示され、ホームディレクトリがGitリポジトリ化していることが発覚した。

### Step 2: 安全なバックアップの確保

- リポジトリの破壊的な変更を行う前に、作業内容を保護するため、`backend` ディレクトリ全体と、`frontend` の `.env`, `.gitignore` ファイルをプロジェクト外の `C:\Users\tenma\backup` フォルダにコピーした。

### Step 3: 誤ったリポジトリの完全削除

- **警告**: この手順はリポジトリの歴史を完全に削除するため、慎重な実行が求められる。
- ユーザーのホームディレクトリに移動 (`cd C:\Users\tenma`)
- ホームディレクトリにある `.git` フォルダを `rmdir /s /q .git` コマンドで完全に削除した。

### Step 4: 正常なリポジトリの再構築

- 本来あるべきプロジェクトのルートディレクトリ (`C:\Users\tenma\movie-app`) に移動。
- `git init` コマンドを実行し、クリーンなリポジトリを再初期化した。

### Step 5: ネストされたリポジトリの修正

- `git add .` を実行した際に `adding embedded git repository: frontend` という警告が表示された。
- `frontend` ディレクトリ内に存在する不要な `.git` フォルダを `rmdir /s /q .git` コマンドで削除し、問題を解決した。

### Step 6: `.gitignore` の徹底的な整備

- `backend` と `frontend` の `.gitignore` ファイルの内容をそれぞれ見直した。
- さらに、プロジェクトルートに新たに `.gitignore` を作成し、`.vite/`, `.serena/`, `.ruff_cache/`, `venv/` など、プロジェクト全体にまたがる無視ルールを定義した。

### Step 7: 最初のコミットと、その修正

1.  `git add .` ですべてのファイルをステージング。
2.  最初のコミットを実行したが、`.gitignore` の適用タイミングの問題で、不要なファイル (`.vite/`, `.serena/`) が含まれてしまった。
3.  `git rm --cached -r .vite .serena` を実行し、コミット済みのファイルをGitの追跡から除外。
4.  新しく作成したルートの `.gitignore` を `git add .gitignore` でステージング。
5.  `git commit --amend --no-edit` コマンドを使い、直前のコミットを正しい内容で上書き修正した。

---

## 最終的な状態と教訓

- `git status` を実行し、`working tree clean` と表示される、完全にクリーンで正常なリポジトリの状態に復旧した。

### 教訓

- `git init` は、必ずプロジェクトのルートディレクトリで実行する。
- `.gitignore` は、プロジェクトの初期段階で包括的に設定することが、後の手戻りを防ぐ鍵となる。
- `git status` はこまめに実行し、意図しないファイルが追跡対象になっていないか常に確認する習慣が重要。
